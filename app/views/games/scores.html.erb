<div>
  <h1 class="pull-left">Nertz Scores for Game <%= @game.id %></h1>
  <%= form_tag add_team_to_game_path,
    :method => :put,
    :id => 'add-team-form',
    class: 'pull-right' do %>

    <select class="custom-select" id="team-type" name="team_type" style="width:auto" <%= 'autofocus' if @focus_on_adding_teams %>>
      <option selected value=<%= Team::DOUBLES %>>Doubles</option>
      <option value=<%= Team::SINGLES %>>Singles</option>
    </select>

    <select class="custom-select" id="player-1" name="player_1" style="width:auto">
      <option selected value="0">Player 1</option>
      <% Player.order(:name).each do |player| %>
        <option value=<%= player.id %>><%= player.name %></option>
      <% end %>
    </select>

    <select class="custom-select" id="player-2" name="player_2" style="width:auto">
      <option selected value="0">Player 2</option>
      <% Player.order(:name).each do |player| %>
        <option value=<%= player.id %>><%= player.name %></option>
      <% end %>
    </select>

    <button type="submit" class="btn btn-success mx-sm-3"><i class="fa fa-plus-square"></i> Add team</button>
  <% end %>
</div>

<table class="table table-condensed table-striped table-hover" style="text-align: center">
  <thead>
    <th>Round</th>
    <% @team_games.each do |team_game| %>
      <th>
        <%= form_tag toggle_team_game_active_path(team_game_id: team_game.id),
          :method => :post do %>
          <div class="form-check form-check-inline">
            <input
              class="form-check-input"
              id="toggle-team-check-input-<%= team_game.id %>"
              type="checkbox"
              name="team_game_id"
              <%= 'checked' if team_game.active? %>>
            <label
              title="<%= team_game.team.team_members_label %>"
              class="form-check-label"
              for="toggle-team-check-input-<%= team_game.id %>">
              <%= team_game.team.name %>
            </label>
          </div>
        <% end %>
      </th>
    <% end %>
    <th></th>
    <th></th>
  </thead>
  <tbody>
    <% @rounds_by_number.keys.sort.each do |round_number| %>
      <tr>
        <%= render 'round_row', round_number: round_number, game_id: @game.id %>
      </tr>
    <% end %>
    <%= render 'new_round_row' %>
  </tbody>
</table>

<%= line_chart_total_score_over_rounds(team_games_with_colors: @team_games_with_colors) %>

<script type="text/javascript">
  $(function() {
    // For on-checked toggling of TeamGame active boolean
    $('input.form-check-input').change(function() {
      $(this).parents('form:first').submit();
    })

    // Show and hide player 2 when switching from doubles to singles
    $('select#team-type').change(function() {
      $('#player-2').val(0);

      if ( $('select#team-type' ).val() == 'doubles' ) {
        $('#player-2').css('visibility','visible');
      } else if ( $('select#team-type').val() == 'singles') {
        $('#player-2').css('visibility','hidden');
      }
    })

    // Hotkey shortcut for New Round (Shift + n)
    window.addEventListener('keypress', function(e) {
      if (e.shiftKey && e.keyCode == 78) {
        $('form#new-round-form').submit();
      }
    });
  })
</script>
